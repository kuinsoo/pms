<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.or.ddit.work.mapper.WorkMapper">

	<!-- 업무 전체 일정 -->
	<select id="workAllSchedule" resultType="workVo" parameterType="scheduleVo">
	<!-- 일정에 필요한 컬럼 정리: 업무제목, 업무시작일자, 업무예상마감일자, 업무마감일자, 업무일정색깔 -->
		SELECT	w.work_title,
				w.work_sdate,
				w.work_eedate,
				w.work_edate,
				w.work_color
		<choose>
			<when test="pid != null">
				FROM	work w
				WHERE	work_project = #{pid}
			</when>
			<otherwise>
				FROM    work_member wm INNER JOIN project_member pm
				ON      wm.pmember_id = pm.pmember_id INNER JOIN work w
				ON      wm.work_id = w.work_id
				WHERE   pm.pmember_member = #{sid}
			</otherwise>
		</choose>
	</select>

	<select id="selectWorks" resultType="workVo" parameterType="Map">
		select  W.WORK_TITLE, 
        W.WORK_CONTENT,
        W.WORK_TYPE,
        W.WORK_IMPORTANCE,
        W.WORK_SDATE,
        W.WORK_EEDATE,
        W.WORK_APPROVAL,
        W.WORK_PUBLIC,
        P.PROJECT_TITLE,
        M.MEMBER_MAIL,
		W.WORK_ID
		from member M INNER JOIN project_member PM ON (M.member_mail = PM.pmember_member AND M.MEMBER_MAIL = #{member_mail})
		INNER JOIN PROJECT P ON (PM.PMEMBER_PROJECT = P.PROJECT_ID AND P.PROJECT_ID=#{project_id})
		INNER JOIN WORK W ON (P.PROJECT_ID = W.WORK_PROJECT)
		order by WORK_ID desc
	</select>
	
	<insert id="createWork" parameterType="workVo">
		insert into work 
		values(SEQ_WORK.NEXTVAL, #{work_project}, #{work_title}, #{work_content}, #{work_type}, ${work_importance},
					 #{work_sdate}, #{work_eedate},0, 'N','',#{work_public},'#4286f4')
	</insert>
	
	<delete id="deleteWork" parameterType="String">
		DELETE FROM WORK WHERE WORK_ID = #{work_id}
	</delete>
	
	<update id="updateWork" parameterType="workVo">
		UPDATE WORK
		SET WORK_TITLE = #{work_title}, WORK_CONTENT = #{work_content}, WORK_TYPE = #{work_type},
		 WORK_IMPORTANCE = ${work_importance},  WORK_SDATE = #{work_sdate}, WORK_EEDATE = #{work_eedate},
		 WORK_PROGRESS = #{work_progress}, WORK_EDATE = #{work_edate} , WORK_PUBLIC = #{work_public},
		 WORK_COLOR = #{work_color}
		WHERE work_id = #{work_id}
	</update>
	
	
	
	

</mapper>
