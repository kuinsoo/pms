<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.or.ddit.member.mapper.MemberMapper">
    <resultMap id="pmemberResultMap" type="memberVo">
        <id property="member_name" column="member_name" />
        <id property="member_profile" column="member_profile" />
        <id property="pmemberCount" column="pmemberCount" />
        <collection property="projectList" ofType="projectVo">
            <id property="project_title" column="project_title" />
            <id property="project_overview" column="project_overview" />
            <id property="project_bookmark" column="project_bookmark" />
            <id property="project_id" column="project_id" />
        </collection>
        <collection property="pmemberList" ofType="pmemberVo">
            <id property="pmember_position" column="pmember_position" />
        </collection>
    </resultMap>

    <select id="selectMainView" parameterType="String" resultMap="pmemberResultMap">
        SELECT  DISTINCT
		        p.project_title,
		        p.project_overview,
		        p.project_bookmark,
		        p.project_id,
		        m.member_name,
		        m.member_profile,
		        pmember_position,
		        pmemberCount.*
		FROM    project p INNER JOIN project_member pm
		ON      p.project_id = pm.pmember_project INNER JOIN member m
		ON      pm.pmember_member = m.member_mail INNER JOIN (SELECT  pmember_project,
		                                                              COUNT(*) as pmemberCount
		                                                      FROM    project_member
		                                                      WHERE   pmember_project IN (SELECT  pmember_project
		                                                                                  FROM    project_member
		                                                                                  WHERE   pmember_member = #{member_mail})
		                                                      GROUP BY pmember_project) pmemberCount
		ON      pm.pmember_project = pmemberCount.pmember_project
		WHERE   m.member_mail = #{member_mail}
		order by p.PROJECT_TITLE
    </select>
	<!--
		SELECT  DISTINCT
		        p.project_title,
		        p.project_overview,
		        p.project_bookmark,
		        m.member_name,
		        m.member_profile,
		        pmcount.*
		FROM    project p INNER JOIN project_member pm
		ON      p.project_id = pm.pmember_project INNER JOIN member m
		ON      pm.pmember_member = m.member_mail INNER JOIN (SELECT  pmember_project,
		                                                              COUNT(*)
		                                                      FROM    project_member
		                                                      WHERE   pmember_project IN (SELECT  pmember_id
		                                                                                  FROM    project_member
		                                                                                  WHERE   pmember_member = 'kkuinsoo@gmail.com')
		                                                      GROUP BY pmember_project) pmcount
		ON      pm.pmember_project = pmcount.pmember_project
		WHERE   m.member_mail = 'kkuinsoo@gmail.com';
	 -->



</mapper>