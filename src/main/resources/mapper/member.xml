<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="kr.or.ddit.member.mapper.MemberMapper">

	<!--  로그인  -->  
	<select id="selectUser" resultType="memberVo" parameterType="String">
		select *
		from member 
		where member_mail = #{member_mail}
	</select>
	
	<!-- 회원가입  -->
	<insert id="insertUser" parameterType="memberVo">    
		insert into 
		member
		values (#{member_mail},#{member_name},#{member_pass},#{member_tel},'/images/basic.png','N')
	</insert>
	
	<update id="updateUser" parameterType="memberVo">    
		update member
		set member_pass = #{member_pass}, member_tel = #{member_tel} , member_name = #{member_name}
		<if test="member_profile != null">, member_profile = #{member_profile, jdbcType=VARCHAR} </if>
		where member_mail = #{member_mail}
	</update>
	
	<!-- 아이디 찾기 -->
	<select id="selectfindId" resultType="memberVo" parameterType="String">
		select *
		from member 
		where member_tel = #{member_tel}
		and member_name = #{member_name}
	</select>
	
	<!-- 비밀번호 찾기 -->
	<select id="selectfindPass" parameterType="String" resultType="memberVo">
		select *
		from member 
		where member_mail=#{member_mail}
	</select>

	<!-- 비밀번호 변경 -->
	<update id="updatePass" parameterType="memberVo">
		update member
		set member_pass = #{member_pass}
		where member_mail = #{member_mail}
	</update>
	
	<!-- @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@  마이페이지 부분  @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ -->
	<!--  참여중인 프로젝트  -->
	<select id="myprojectselect" resultType="projectVo" parameterType="pageVo">
	select * from(
 			select rownum rnum ,a.*
				from 	
				    (SELECT (SELECT PROJECT_TITLE FROM PROJECT WHERE PROJECT_ID = PMEMBER_PROJECT) as project_title
                    , PMEMBER_MEMBER as pmember_member
               FROM   PROJECT_MEMBER
               WHERE  PMEMBER_MEMBER = #{member_mail}
               AND    PMEMBER_POSITION = '1'
               UNION
               SELECT (SELECT PROJECT_TITLE FROM PROJECT WHERE PROJECT_ID = PMEMBER_PROJECT)
                    , (SELECT B.PMEMBER_MEMBER FROM PROJECT_MEMBER B WHERE B.PMEMBER_PROJECT = A.PMEMBER_PROJECT AND B.PMEMBER_POSITION = 1) 
               FROM   PROJECT_MEMBER A
               WHERE  A.PMEMBER_MEMBER = #{member_mail}
               AND    A.PMEMBER_POSITION = '2')a)
			where rnum between ${page}*${pageSize}-(${pageSize}-1)
		and ${page}*${pageSize}
		<if test="searchText!=null and searchText!=''">and project_title like '%'||#{searchText}||'%'</if>
	</select>
	
	<!-- 프로젝트 전체 개수 가져오기  -->	
	<select id="totalProjectCnt" resultType="int">
		select count (*)
		from project
	 </select>

	<!--  즐겨찾기한 프로젝트  -->
	<select id = "mybookmarkselect" resultType="projectVo" parameterType="pageVo">
		
		select * from
		    (select ROWNUM rnum, a.*
		     from
		        (SELECT  p.project_title  as project_title,
		                pmem.pmember_member as pmember_member
		        FROM    project p INNER JOIN project_member pm
		        ON      p.project_id = pm.pmember_project LEFT JOIN (SELECT pmember_project,
		                                                                    pmember_member
		                                                             FROM   project_member
		                                                             WHERE  pmember_position = 1) pmem
		        ON      p.project_id = pmem.pmember_project
		        WHERE   pm.pmember_member = 'sally1334@naver.com'
		        AND     pm.pmember_bookmark = 'Y')a)
		   		where rnum between ${page}*${pageSize}-(${pageSize}-1)
			and ${page}*${pageSize}
		<if test="searchText!=null and searchText!=''">and project_title like '%'||#{searchText}||'%'</if> 
	
	</select>
</mapper>
















